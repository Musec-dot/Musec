<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Musec Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              background: '#050505',
              card: '#121212',
              cardHover: '#1A1A1A',
              accent: '#FFCD9E', // The peach color
              accentDark: '#E0AC7E',
              secondary: '#262626',
              muted: '#888888',
              surface: '#1E1E1E',
            },
            boxShadow: {
              'glow': '0 0 20px rgba(255, 205, 158, 0.1)',
            },
            animation: {
              'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            }
          }
        }
      }
    </script>
    <style>
      body {
        background-color: #050505;
        color: #ffffff;
      }
      /* Custom scrollbar */
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: #050505; }
      ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
      ::-webkit-scrollbar-thumb:hover { background: #444; }
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      
      /* Audio Wave Animation */
      .wave-bar {
        animation: wave-anim 1s ease-in-out infinite;
        border-radius: 999px;
      }
      @keyframes wave-anim {
        0%, 100% { height: 30%; opacity: 0.5; }
        50% { height: 100%; opacity: 1; }
      }
      
      /* Dropdown styles */
      .dropdown {
        display: none;
        position: absolute;
        top: 50px; 
        right: 0;
        background-color: #121212;
        border: 1px solid #333;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        z-index: 1000;
        min-width: 150px;
      }
      .dropdown a {
        display: block;
        padding: 10px;
        color: white;
        text-decoration: none;
      }
      .dropdown a:hover { background-color: #FFCD9E; color: #050505; }
    </style>
  <link rel="stylesheet" href="/index.css">
  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* Floating Navbar Styles - Same as jobs.ejs */
    .navbar-container {
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: center;
      padding: 1.5rem 1rem 1rem 1rem;
      background-color: rgba(5, 5, 5, 0.95);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    .navbar {
      background-color: #121212;
      border-radius: 9999px;
      padding: 0.75rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      max-width: 64rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
    }
    .search-container {
      position: relative;
    }
    .search-icon {
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      color: #9ca3af;
      pointer-events: none;
      width: 18px;
      height: 18px;
    }
    .search-input {
      background-color: #1e1e1e;
      color: #d1d5db;
      font-size: 0.875rem;
      border-radius: 9999px;
      padding: 0.625rem 1rem 0.625rem 2.5rem;
      width: 16rem;
      border: none;
      outline: none;
      transition: all 0.2s;
    }
    .search-input:focus {
      box-shadow: 0 0 0 1px #4b5563;
      background-color: #252525;
    }
    .nav-links {
      display: flex;
      align-items: center;
      gap: 2rem;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      color: #9ca3af;
      transition: color 0.2s;
      text-decoration: none;
    }
    .nav-item:hover {
      color: #e5e7eb;
    }
    .nav-item.active {
      color: #ffdec1;
    }
    .nav-item .icon-wrapper {
      transition: transform 0.2s;
    }
    .nav-item:hover .icon-wrapper {
      transform: scale(1.1);
    }
    .nav-label {
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 0.025em;
    }
    .user-avatar {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      background: linear-gradient(135deg, #9ca3af, #4b5563);
      border: 2px solid #121212;
      cursor: pointer;
      transition: opacity 0.2s;
    }
    .user-avatar:hover {
      opacity: 0.8;
    }
  </style>
</head>
  <body class="bg-background text-white font-sans selection:bg-accent selection:text-black">
    
    <!-- Floating Navbar -->
    <div class="navbar-container">
      <nav class="navbar">
        <div class="search-container">
          <i data-lucide="search" class="search-icon"></i>
          <input type="text" placeholder="Parin goat?" class="search-input">
        </div>
        <div class="nav-links">
          <a href="/" class="nav-item active">
            <div class="icon-wrapper"><i data-lucide="home" width="22" height="22"></i></div>
            <span class="nav-label">Home</span>
          </a>
          <a href="/jobs" class="nav-item">
            <div class="icon-wrapper"><i data-lucide="briefcase" width="22" height="22"></i></div>
            <span class="nav-label">Jobs</span>
          </a>
          <a href="/explore-musicians" class="nav-item">
            <div class="icon-wrapper"><i data-lucide="users" width="22" height="22"></i></div>
            <span class="nav-label">Network</span>
          </a>
          <a href="/msg" class="nav-item">
            <div class="icon-wrapper"><i data-lucide="message-square" width="22" height="22"></i></div>
            <span class="nav-label">Messaging</span>
          </a>
          <a href="/requests" class="nav-item">
            <div class="icon-wrapper"><i data-lucide="bell" width="22" height="22"></i></div>
            <span class="nav-label">Notifications</span>
          </a>
          <% if (locals.user && locals.user.profilePic) { %>
            <a href="/user/<%= user._id %>" class="user-avatar" style="background-image: url('<%= user.profilePic %>'); background-size: cover; background-position: center;"></a>
          <% } else { %>
            <div class="user-avatar"></div>
          <% } %>
        </div>
      </nav>
    </div>
    <script>lucide.createIcons();</script>

      <!-- Profile & Add -->
      <div class="flex items-center gap-6">
        <button class="w-10 h-10 rounded-full bg-surface flex items-center justify-center hover:bg-white hover:text-black transition-all group">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-muted group-hover:text-black" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
        </button>
        
        <div class="flex-shrink-0 cursor-pointer relative">
          <div class="w-11 h-11 rounded-full p-[2px] bg-gradient-to-b from-white/20 to-transparent" id="avatarContainer">
            <img 
              src="<%= locals.user?.profilePic || '/images/avatar.png' %>" 
              alt="Profile" 
              class="w-full h-full rounded-full object-cover border-2 border-background"
              id="avatar"
            />
          </div>
          <div class="absolute bottom-1 right-0 w-3 h-3 bg-[#4ADE80] rounded-full border-2 border-background shadow-sm"></div>
          <div class="dropdown position-absolute top-100 mt-2 bg-dark text-white p-2" id="dropdownMenu" style="display:none;right:0;">
            <a href="/bio.html" class="dropdown-item text-white">My Profile</a>
            <a href="/settings.html" class="dropdown-item text-white">Settings</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Layout -->
    <main class="max-w-[1800px] mx-auto p-6 grid grid-cols-1 lg:grid-cols-12 gap-20">
      
      <!-- Left Sidebar -->
      <aside class="hidden lg:block lg:col-span-3 xl:col-span-3 sticky top-24 h-[calc(100vh-8rem)] overflow-y-auto no-scrollbar">
        <div class="flex flex-col gap-6 w-full">
          <!-- Studio Map Widget -->
          <div class="bg-card rounded-[32px] overflow-hidden p-5 shadow-2xl border border-white/5 relative group hover:border-white/10 transition-all">
            <div class="relative w-full aspect-[4/3] bg-[#1f1f1f] rounded-2xl overflow-hidden mb-5">
              <!-- Map Visuals -->
              <div class="absolute inset-0 bg-cover bg-center opacity-60 mix-blend-luminosity hover:mix-blend-normal transition-all duration-700" style="background-image: url('https://api.mapbox.com/styles/v1/mapbox/dark-v10/static/-122.4194,37.7749,13,0/600x600?access_token=pk.eyJ1IjoiZGVtb21hcHMiLCJhIjoiY2xwZmRpZ21oMDBxZDJqbzh4Z2Z4Z2Z4In0.1');"></div>
              <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
              
              <!-- Map Pins -->
              <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 transform">
                <div class="relative">
                  <div class="absolute -inset-2 bg-accent/20 rounded-full blur-md animate-pulse"></div>
                  <svg xmlns="http://www.w3.org/2000/svg" class="relative w-8 h-8 text-accent drop-shadow-md" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                </div>
              </div>
            </div>

            <% if (locals.studios && locals.studios.length > 0) { %>
              <% locals.studios.slice(0, 1).forEach(studio => { %>
                <div class="flex justify-between items-end mb-3">
                  <div>
                    <h2 class="text-xl font-bold text-white mb-1.5 tracking-tight"><%= studio.name %></h2>
                    <div class="flex items-center gap-3 text-xs font-semibold">
                      <span class="text-muted"><%= studio.distance %> km</span>
                      <span class="flex items-center <%= studio.rating >= 4.0 ? 'text-[#4ADE80]' : 'text-red-500' %> gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 fill-current" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg> <%= studio.rating %>
                      </span>
                      <span class="<%= studio.status === 'Available' ? 'text-[#4ADE80] bg-[#4ADE80]/10 border-[#4ADE80]/20' : 'text-red-500 bg-red-500/10 border-red-500/20' %> px-2 py-0.5 rounded-full border"><%= studio.status %></span>
                    </div>
                  </div>
                  <button class="bg-accent text-[#050505] font-bold py-2.5 px-6 rounded-xl hover:bg-white hover:scale-105 transition-all shadow-glow">
                    BOOK
                  </button>
                </div>
              <% }); %>
            <% } else { %>
              <div class="flex justify-between items-end mb-3">
                <div>
                  <h2 class="text-xl font-bold text-white mb-1.5 tracking-tight">Musec studio</h2>
                  <div class="flex items-center gap-3 text-xs font-semibold">
                    <span class="text-muted">2.2 km</span>
                    <span class="flex items-center text-[#4ADE80] gap-1">
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 fill-current" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg> 4.9
                    </span>
                    <span class="text-[#4ADE80] bg-[#4ADE80]/10 px-2 py-0.5 rounded-full border border-[#4ADE80]/20">Available</span>
                  </div>
                </div>
                <button class="bg-accent text-[#050505] font-bold py-2.5 px-6 rounded-xl hover:bg-white hover:scale-105 transition-all shadow-glow">
                  BOOK
                </button>
              </div>
            <% } %>

            <div class="mt-5 pt-4 border-t border-white/5 flex items-center justify-between group/link cursor-pointer">
              <span class="text-sm font-medium text-muted group-hover/link:text-white transition-colors">Connect With Studios</span>
              <div class="w-8 h-8 rounded-full bg-surface flex items-center justify-center group-hover/link:bg-accent group-hover/link:text-black transition-all">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </div>
            </div>
          </div>

          <!-- Trending Genres -->
          <div class="bg-card rounded-[32px] p-6 shadow-xl border border-white/5">
            <h3 class="text-lg font-bold text-white mb-5">Trending Genres</h3>
            <div class="flex flex-wrap gap-2.5">
              <span class="px-4 py-2 rounded-full text-xs font-semibold cursor-pointer transition-all hover:scale-105 border bg-surface text-muted border-white/5 hover:border-white/20 hover:text-white">Hip-Hop</span>
              <span class="px-4 py-2 rounded-full text-xs font-semibold cursor-pointer transition-all hover:scale-105 border bg-surface text-muted border-white/5 hover:border-white/20 hover:text-white">R&B</span>
              <span class="px-4 py-2 rounded-full text-xs font-semibold cursor-pointer transition-all hover:scale-105 border bg-[#181818] text-[#555] border-transparent hover:text-white hover:bg-surface">Electronic</span>
              <span class="px-4 py-2 rounded-full text-xs font-semibold cursor-pointer transition-all hover:scale-105 border bg-[#181818] text-[#555] border-transparent hover:text-white hover:bg-surface">Rock</span>
              <span class="px-4 py-2 rounded-full text-xs font-semibold cursor-pointer transition-all hover:scale-105 border bg-[#181818] text-[#555] border-transparent hover:text-white hover:bg-surface">Jazz</span>
            </div>
          </div>
        </div>
      </aside>

      <!-- Feed -->
      <section class="col-span-1 lg:col-span-6 xl:col-span-6">
        <div class="flex flex-col gap-8 w-full">
          <!-- Create Post -->
          <div class="bg-card rounded-[32px] p-6 border border-white/5 relative overflow-hidden">
             <!-- Subtle background glow -->
             <div class="absolute top-0 right-0 w-64 h-64 bg-accent/5 rounded-full blur-[100px] pointer-events-none"></div>

            <form action="/new" method="POST" enctype="multipart/form-data">
              <div class="flex gap-4 mb-6 relative">
                <div class="w-12 h-12 rounded-full p-[2px] bg-gradient-to-br from-white/10 to-transparent flex-shrink-0">
                   <img src="<%= locals.user?.profilePic || '/images/avatar.png' %>" alt="Me" class="w-full h-full rounded-full object-cover" />
                </div>
                <div class="flex-1 pt-2">
                  <input
                    type="text"
                    name="title"
                    placeholder="Write a post..."
                    class="w-full bg-transparent text-lg text-white placeholder-muted border-none p-0 focus:outline-none focus:ring-0 font-light"
                    required
                  />
                </div>
              </div>
              
              <!-- Divider -->
              <div class="h-px bg-white/5 w-full mb-5"></div>

              <div class="flex items-center justify-between relative">
                <div class="flex gap-3">
                  <input type="file" name="media" id="mediaInput" accept="image/*,video/*,audio/*" style="display:none;">
                  <label for="mediaInput" class="flex items-center gap-2 px-4 py-2 rounded-full text-[11px] font-bold transition-all bg-surface text-muted border border-white/5 hover:bg-[#2a2a2a] hover:text-white cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                    Photo
                  </label>
                  <label for="mediaInput" class="flex items-center gap-2 px-4 py-2 rounded-full text-[11px] font-bold transition-all bg-surface text-muted border border-white/5 hover:bg-[#2a2a2a] hover:text-white cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"></polygon><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg>
                    Video
                  </label>
                  <label for="mediaInput" class="flex items-center gap-2 px-4 py-2 rounded-full text-[11px] font-bold transition-all bg-surface text-muted border border-white/5 hover:bg-[#2a2a2a] hover:text-white cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
                    Audio
                  </label>
                  <a href="/go-live" class="flex items-center gap-2 px-4 py-2 rounded-full text-[11px] font-bold transition-all bg-surface text-muted border border-white/5 hover:bg-[#2a2a2a] hover:text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8"></polygon></svg>
                    Go Live
                  </a>
                </div>
                
                <div class="flex gap-3">
                  <button type="submit" class="w-10 h-10 rounded-full flex items-center justify-center border border-indigo-500/20 bg-indigo-500/10 text-indigo-400 hover:bg-indigo-500 hover:text-white transition-all group">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 group-hover:rotate-12 transition-transform" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>
                  </button>
                </div>
              </div>
            </form>
          </div>

          <!-- Filter Tabs -->
          <div class="flex gap-3 overflow-x-auto pb-1 scrollbar-hide items-center no-scrollbar">
            <button class="px-5 py-2.5 rounded-full text-xs font-bold transition-all whitespace-nowrap border bg-accent text-[#050505] border-accent shadow-glow scale-105">All</button>
            <button class="px-5 py-2.5 rounded-full text-xs font-bold transition-all whitespace-nowrap border bg-surface text-[#666] border-transparent hover:text-white hover:bg-[#2a2a2a]">Hip-Hop</button>
            <button class="px-5 py-2.5 rounded-full text-xs font-bold transition-all whitespace-nowrap border bg-surface text-[#666] border-transparent hover:text-white hover:bg-[#2a2a2a]">R&B</button>
            <button class="px-5 py-2.5 rounded-full text-xs font-bold transition-all whitespace-nowrap border bg-surface text-[#666] border-transparent hover:text-white hover:bg-[#2a2a2a]">Electronic</button>
            <button class="px-5 py-2.5 rounded-full text-xs font-bold transition-all whitespace-nowrap border bg-surface text-[#666] border-transparent hover:text-white hover:bg-[#2a2a2a]">Rock</button>
            <button class="px-5 py-2.5 rounded-full text-xs font-bold transition-all whitespace-nowrap border bg-surface text-[#666] border-transparent hover:text-white hover:bg-[#2a2a2a]">Jazz</button>
          </div>

          <!-- Posts Container -->
          <div class="flex flex-col gap-6">
            <% if (locals.posts && locals.posts.length) { %>
              <% locals.posts.forEach(post => { %>
                <div class="bg-card rounded-[32px] p-7 border border-white/5 hover:border-white/10 transition-all group">
                  <!-- Header -->
                  <div class="flex justify-between items-start mb-4">
                    <div class="flex gap-4">
                      <a href="/user/<%= post.author?._id %>" class="relative cursor-pointer">
                         <div class="w-11 h-11 rounded-full p-[2px] bg-gradient-to-tr from-white/20 to-transparent">
                           <img src="<%= post.author?.profilePic || '/images/avatar.png' %>" alt="<%= post.author?.username || 'User' %>" class="w-full h-full rounded-full object-cover" />
                         </div>
                      </a>
                      <div class="flex flex-col justify-center">
                        <h4 class="text-[15px] font-bold text-white leading-tight mb-0.5 hover:underline decoration-accent/50 underline-offset-4 cursor-pointer"><%= post.author?.username || 'User' %></h4>
                        <span class="text-[11px] font-medium text-muted tracking-wide"><%= post.author?.followersCount || 0 %> followers</span>
                      </div>
                    </div>
                    <div class="flex items-center gap-2">
                      <button class="text-muted/50 hover:text-white transition-colors p-2 -mr-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg>
                      </button>
                      <% if (locals.user && locals.user._id && post.author && post.author._id !== locals.user._id) { %>
                        <form action="/requests/send" method="POST" style="margin:0;">
                          <input type="hidden" name="toId" value="<%= post.author._id %>">
                          <button class="px-4 py-1.5 rounded-full border border-white/10 text-[10px] font-bold text-white hover:bg-white hover:text-black hover:border-transparent transition-all tracking-wide" type="submit">Connect</button>
                        </form>
                      <% } %>
                    </div>
                  </div>

                  <!-- Content -->
                  <div class="mb-5">
                    <% if (post.title) { %>
                      <h5 class="text-lg font-bold text-white mb-2"><%= post.title %></h5>
                    <% } %>
                    <% if (post.content && post.content.trim() !== "") { %>
                      <p class="text-[14px] text-gray-300 mb-5 leading-relaxed font-light"><%= post.content %></p>
                    <% } %>
                    
                    <% if (post.fileUrl && post.fileType === 'image') { %>
                      <div class="rounded-2xl overflow-hidden mb-5 border border-white/5 shadow-2xl">
                        <img src="<%= post.fileUrl %>" alt="Post image" class="w-full h-auto object-cover hover:scale-[1.02] transition-transform duration-500" />
                      </div>
                    <% } else if (post.fileUrl && post.fileType === 'video') { %>
                      <div class="rounded-2xl overflow-hidden mb-5 border border-white/5 shadow-2xl">
                        <video class="w-full h-auto" controls>
                          <source src="<%= post.fileUrl %>" type="video/mp4">
                          Your browser does not support the video tag.
                        </video>
                      </div>
                    <% } else if (post.fileUrl && post.fileType === 'audio') { %>
                      <div class="bg-[#181818] rounded-2xl p-4 mb-5 flex items-center gap-4 border border-white/5 shadow-inner relative overflow-hidden">
                        <div class="absolute bottom-0 left-0 h-[2px] bg-white/5 w-full">
                          <div class="h-full bg-accent w-1/3"></div>
                        </div>
                        <button class="w-12 h-12 rounded-full bg-accent flex items-center justify-center text-[#050505] hover:scale-105 hover:shadow-glow transition-all flex-shrink-0 z-10">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 fill-current" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
                        </button>
                        <div class="flex-1 flex flex-col justify-center z-10">
                          <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold text-white">Audio Track</span>
                            <span class="text-[10px] text-muted font-mono">0:00</span>
                          </div>
                          <audio class="w-full" controls>
                            <source src="<%= post.fileUrl %>" type="audio/mpeg">
                            Your browser does not support the audio element.
                          </audio>
                        </div>
                      </div>
                    <% } %>
                  </div>

                  <!-- Actions -->
                  <div class="flex items-center gap-8 pt-2">
                    <button 
                      onclick="toggleLike('<%= post._id %>', this)" 
                      class="flex items-center gap-2.5 transition-colors group like-btn"
                      data-post-id="<%= post._id %>"
                    >
                      <div class="p-2 -m-2 rounded-full group-hover:bg-accent/10 transition-colors">
                          <svg xmlns="http://www.w3.org/2000/svg" 
                            class="w-[18px] h-[18px] group-hover:scale-110 transition-transform <%= post.isLiked ? 'fill-accent text-accent' : 'text-muted/80' %>" 
                            viewBox="0 0 24 24" 
                            fill="<%= post.isLiked ? 'currentColor' : 'none' %>" 
                            stroke="currentColor" 
                            stroke-width="2" 
                            stroke-linecap="round" 
                            stroke-linejoin="round">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                          </svg>
                      </div>
                      <span class="text-xs font-semibold like-count"><%= post.likes?.length || 0 %></span>
                    </button>
                    <button 
                      onclick="toggleComments('<%= post._id %>', this)" 
                      class="flex items-center gap-2.5 text-muted/80 hover:text-accent transition-colors group comment-btn"
                      data-post-id="<%= post._id %>"
                    >
                      <div class="p-2 -m-2 rounded-full group-hover:bg-accent/10 transition-colors">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-[18px] h-[18px] group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                      </div>
                      <span class="text-xs font-semibold comment-count"><%= post.commentsCount || 0 %></span>
                    </button>
                    <button class="flex items-center gap-2.5 text-muted/80 hover:text-accent transition-colors group">
                      <div class="p-2 -m-2 rounded-full group-hover:bg-accent/10 transition-colors">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-[18px] h-[18px] group-hover:scale-110 transition-transform" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg>
                      </div>
                      <span class="text-xs font-semibold">Repost</span>
                    </button>
                    <div class="flex-1"></div>
                    <button class="flex items-center gap-2 text-xs font-bold text-muted hover:text-white transition-colors bg-surface px-4 py-2 rounded-full hover:bg-white hover:text-black">
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg>
                      Share
                    </button>
                  </div>

                  <!-- Comments Section (Hidden by default) -->
                  <div class="comments-section hidden mt-6 pt-6 border-t border-white/5" id="comments-<%= post._id %>">
                    <!-- Comment Form -->
                    <form class="comment-form mb-6" onsubmit="addComment(event, '<%= post._id %>')">
                      <div class="flex gap-3">
                        <div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                          <img src="<%= locals.user?.profilePic || '/images/avatar.png' %>" alt="Your profile" class="w-full h-full object-cover" />
                        </div>
                        <div class="flex-1">
                          <input 
                            type="text" 
                            placeholder="Write a comment..." 
                            class="w-full bg-surface text-white text-sm rounded-full px-4 py-2.5 focus:outline-none focus:ring-1 focus:ring-accent/50 border border-white/5 placeholder:text-muted"
                            required
                            id="comment-input-<%= post._id %>"
                          />
                        </div>
                        <button 
                          type="submit"
                          class="px-4 py-2.5 rounded-full bg-accent text-[#050505] text-sm font-bold hover:bg-accentDark transition-colors"
                        >
                          Post
                        </button>
                      </div>
                    </form>

                    <!-- Comments List -->
                    <div class="comments-list" id="comments-list-<%= post._id %>">
                      <% if (post.recentComments && post.recentComments.length > 0) { %>
                        <% post.recentComments.forEach(comment => { %>
                          <div class="flex gap-3 mb-4">
                            <div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                              <img src="<%= comment.author?.profilePic || '/images/avatar.png' %>" alt="<%= comment.author?.username %>" class="w-full h-full object-cover" />
                            </div>
                            <div class="flex-1">
                              <div class="bg-surface rounded-2xl px-4 py-2.5">
                                <div class="flex items-center gap-2 mb-1">
                                  <span class="text-sm font-bold text-white"><%= comment.author?.username %></span>
                                  <span class="text-[10px] text-muted"><%= new Date(comment.createdAt).toLocaleDateString() %></span>
                                </div>
                                <p class="text-sm text-gray-300"><%= comment.content %></p>
                              </div>
                            </div>
                          </div>
                        <% }); %>
                      <% } else { %>
                        <p class="text-muted text-sm text-center py-4">No comments yet. Be the first to comment!</p>
                      <% } %>
                    </div>

                    <!-- Load More Comments Button -->
                    <% if (post.commentsCount > 3) { %>
                      <button 
                        onclick="loadAllComments('<%= post._id %>')"
                        class="text-sm text-accent hover:text-accentDark font-medium mt-2"
                      >
                        View all <%= post.commentsCount %> comments
                      </button>
                    <% } %>
                  </div>
                </div>
              <% }); %>
            <% } else { %>
              <div class="bg-card rounded-[32px] p-7 border border-white/5 text-center">
                <p class="text-muted">No posts yet.</p>
              </div>
            <% } %>
          </div>
        </div>
      </section>

      <!-- Right Sidebar -->
      <aside class="hidden lg:block lg:col-span-3 xl:col-span-3 sticky top-24 h-[calc(100vh-8rem)] overflow-y-auto no-scrollbar">
        <div class="flex flex-col gap-6 w-full">
          <!-- Connect With Musicians -->
          <div class="bg-card rounded-[32px] p-6 border border-white/5">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-white text-lg font-bold">Connect With Musicians</h3>
              <button class="w-8 h-8 rounded-full bg-surface flex items-center justify-center hover:bg-white hover:text-black transition-all group">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-muted group-hover:text-black" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
              </button>
            </div>

            <div class="flex flex-col gap-5">
              <% if (locals.allUsers && locals.allUsers.length) { %>
                <% locals.allUsers.slice(0, 5).forEach(user => { %>
                  <div class="flex items-center justify-between group">
                    <div class="flex items-center gap-3.5">
                      <div class="relative w-11 h-11 rounded-full overflow-hidden ring-2 ring-white/5 group-hover:ring-accent/50 transition-all flex-shrink-0">
                         <div class="absolute inset-0 bg-gradient-to-tr from-accent/20 to-transparent"></div>
                         <img src="<%= user.profilePic || '/images/avatar.png' %>" alt="<%= user.username %>" class="w-full h-full object-cover" />
                      </div>
                      <div class="flex flex-col">
                        <span class="text-sm font-bold text-white group-hover:text-accent transition-colors"><%= user.username %></span>
                        <span class="text-[10px] text-muted font-medium truncate max-w-[140px] leading-tight"><%= user.role || 'Musician' %></span>
                      </div>
                    </div>
                    <form action="/requests/send" method="POST" style="margin:0;">
                      <input type="hidden" name="toId" value="<%= user._id %>">
                      <button class="px-4 py-1.5 rounded-full border border-white/10 text-[10px] font-bold text-white hover:bg-white hover:text-black hover:border-transparent transition-all tracking-wide" type="submit">
                        Connect
                      </button>
                    </form>
                  </div>
                <% }); %>
              <% } else { %>
                <div class="text-muted text-sm">No users found.</div>
              <% } %>
            </div>

            <!-- Explore More Button -->
            <% if (locals.allUsers && locals.allUsers.length > 5) { %>
              <div class="mt-4">
                <a href="/explore-musicians" class="block w-full px-4 py-2.5 rounded-full border border-white/10 text-sm font-bold text-white hover:bg-white hover:text-black hover:border-transparent transition-all text-center">
                  Explore More
                </a>
              </div>
            <% } %>

            <!-- See Live Streams Button -->
            <div class="mt-3">
              <a href="/live-streams" class="block w-full px-4 py-2.5 rounded-full bg-accent text-sm font-bold text-[#050505] hover:bg-accentDark transition-all text-center">
                See Live Streams
              </a>
            </div>

            <!-- Hirer Only: Post Job Button -->
            <% if (locals.user && locals.user.role === 'hirer') { %>
              <div class="mt-3">
                <a href="/post-job" class="block w-full px-4 py-2.5 rounded-full bg-accent text-sm font-bold text-[#050505] hover:bg-accentDark transition-all text-center">
                  Post a Job
                </a>
              </div>
              <div class="mt-3">
                <a href="/hirer/jobs" class="block w-full px-4 py-2.5 rounded-full border border-white/10 text-sm font-bold text-white hover:bg-white hover:text-black hover:border-transparent transition-all text-center">
                  My Jobs
                </a>
              </div>
            <% } %>
          </div>

          <!-- Messages Button -->
          <a href="/msg" class="bg-card rounded-[32px] p-6 border border-white/5 hover:border-white/10 transition-all flex items-center gap-4 group">
            <div class="w-12 h-12 rounded-full bg-accent flex items-center justify-center text-[#050505] flex-shrink-0">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
            </div>
            <div class="flex-1">
              <h4 class="text-sm font-bold text-white mb-1">Messages</h4>
              <p class="text-xs text-muted">Chat with your connections</p>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-muted group-hover:text-white transition-colors" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
          </a>
        </div>
      </aside>

    </main>
  <script>
    // User dropdown JS
    const avatar = document.getElementById('avatar');
    const dropdown = document.getElementById('dropdownMenu');
    const avatarContainer = document.getElementById('avatarContainer');
    
    if (avatarContainer && dropdown) {
        avatarContainer.addEventListener('click', (e) => {
          e.stopPropagation();
          dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });
        document.addEventListener('click', (event) => {
          if (!event.target.closest('#avatarContainer') && !event.target.closest('.dropdown')) {
            dropdown.style.display = 'none';
          }
        });
    }

    // Like/Unlike functionality
    async function toggleLike(postId, button) {
      try {
        const response = await fetch(`/post/${postId}/like`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        const data = await response.json();
        
        if (data.success) {
          const likeIcon = button.querySelector('svg');
          const likeCount = button.querySelector('.like-count');
          
          // Update like count
          likeCount.textContent = data.likesCount;
          
          // Toggle like state
          if (data.isLiked) {
            likeIcon.classList.add('fill-accent', 'text-accent');
            likeIcon.classList.remove('text-muted/80');
            likeIcon.setAttribute('fill', 'currentColor');
          } else {
            likeIcon.classList.remove('fill-accent', 'text-accent');
            likeIcon.classList.add('text-muted/80');
            likeIcon.setAttribute('fill', 'none');
          }
        }
      } catch (error) {
        console.error('Error toggling like:', error);
      }
    }

    // Toggle comments section
    function toggleComments(postId, button) {
      const commentsSection = document.getElementById(`comments-${postId}`);
      if (commentsSection) {
        commentsSection.classList.toggle('hidden');
        
        // Load all comments if section is opened for the first time
        if (!commentsSection.classList.contains('hidden') && !commentsSection.dataset.loaded) {
          loadAllComments(postId);
          commentsSection.dataset.loaded = 'true';
        }
      }
    }

    // Add comment
    async function addComment(event, postId) {
      event.preventDefault();
      
      const input = document.getElementById(`comment-input-${postId}`);
      const content = input.value.trim();
      
      if (!content) return;

      try {
        const response = await fetch(`/post/${postId}/comment`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ content })
        });

        const data = await response.json();
        
        if (data.success) {
          // Clear input
          input.value = '';
          
          // Add comment to list
          const commentsList = document.getElementById(`comments-list-${postId}`);
          const commentDiv = document.createElement('div');
          commentDiv.className = 'flex gap-3 mb-4';
          commentDiv.innerHTML = `
            <div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
              <img src="${data.comment.author.profilePic || '/images/avatar.png'}" alt="${data.comment.author.username}" class="w-full h-full object-cover" />
            </div>
            <div class="flex-1">
              <div class="bg-surface rounded-2xl px-4 py-2.5">
                <div class="flex items-center gap-2 mb-1">
                  <span class="text-sm font-bold text-white">${data.comment.author.username}</span>
                  <span class="text-[10px] text-muted">Just now</span>
                </div>
                <p class="text-sm text-gray-300">${data.comment.content}</p>
              </div>
            </div>
          `;
          
          // Remove "No comments" message if exists
          const noCommentsMsg = commentsList.querySelector('p.text-center');
          if (noCommentsMsg) {
            noCommentsMsg.remove();
          }
          
          commentsList.insertBefore(commentDiv, commentsList.firstChild);
          
          // Update comment count
          const commentCount = document.querySelector(`[data-post-id="${postId}"].comment-btn .comment-count`);
          if (commentCount) {
            const currentCount = parseInt(commentCount.textContent) || 0;
            commentCount.textContent = currentCount + 1;
          }
        }
      } catch (error) {
        console.error('Error adding comment:', error);
        alert('Failed to add comment. Please try again.');
      }
    }

    // Load all comments
    async function loadAllComments(postId) {
      try {
        const response = await fetch(`/post/${postId}/comments`);
        const data = await response.json();
        
        if (data.comments) {
          const commentsList = document.getElementById(`comments-list-${postId}`);
          commentsList.innerHTML = '';
          
          if (data.comments.length === 0) {
            commentsList.innerHTML = '<p class="text-muted text-sm text-center py-4">No comments yet. Be the first to comment!</p>';
          } else {
            data.comments.forEach(comment => {
              const commentDiv = document.createElement('div');
              commentDiv.className = 'flex gap-3 mb-4';
              const date = new Date(comment.createdAt).toLocaleDateString();
              commentDiv.innerHTML = `
                <div class="w-8 h-8 rounded-full overflow-hidden flex-shrink-0">
                  <img src="${comment.author.profilePic || '/images/avatar.png'}" alt="${comment.author.username}" class="w-full h-full object-cover" />
                </div>
                <div class="flex-1">
                  <div class="bg-surface rounded-2xl px-4 py-2.5">
                    <div class="flex items-center gap-2 mb-1">
                      <span class="text-sm font-bold text-white">${comment.author.username}</span>
                      <span class="text-[10px] text-muted">${date}</span>
                    </div>
                    <p class="text-sm text-gray-300">${comment.content}</p>
                  </div>
                </div>
              `;
              commentsList.appendChild(commentDiv);
            });
          }
        }
      } catch (error) {
        console.error('Error loading comments:', error);
      }
    }

  </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>
