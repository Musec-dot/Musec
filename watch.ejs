<!DOCTYPE html><html class="bg-[#0f0f1b] text-white">
<head><meta charset="utf-8"/><title>Watch Live</title>
<script src="https://cdn.tailwindcss.com"></script><script src="/socket.io/socket.io.js"></script></head>
<body class="flex flex-col items-center py-8 gap-6">

<h2 class="text-2xl font-bold text-purple-400">ðŸŽ¬Â Live with <%= stream.streamer.username %></h2>
<video id="vid" autoplay playsinline controls class="w-[720px] h-[405px] rounded-lg bg-black shadow-lg"></video>

<script>
const socket=io(), video=document.getElementById('vid');
const streamId="<%= stream.streamId %>";
let pc;

socket.emit('watcher',{streamId});

socket.on('offer', async (id,desc)=>{
  pc=new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]});
  pc.ontrack=e=>video.srcObject=e.streams[0];
  pc.onicecandidate=e=>e.candidate&&socket.emit('candidate',id,e.candidate);
  await pc.setRemoteDescription(desc);
  const ans=await pc.createAnswer();
  await pc.setLocalDescription(ans);
  socket.emit('answer',id,pc.localDescription);
});

socket.on('candidate',(id,c)=>pc?.addIceCandidate(new RTCIceCandidate(c)));
window.onbeforeunload=()=>{socket.close(); pc?.close();};
</script>
</body></html>
