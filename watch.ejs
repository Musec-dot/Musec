<!DOCTYPE html>
<html lang="en" class="bg-[#0f0f1b] text-white">
<head>
  <meta charset="UTF-8" />
  <title>Watch Live</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body class="flex flex-col items-center justify-center min-h-screen gap-4">

  <h1 class="text-2xl font-bold text-purple-400">ðŸŽ¬ Live Stream</h1>
  <video id="video" autoplay playsinline controls class="rounded-lg shadow-lg w-[720px] h-[405px] bg-black"></video>

  <script>
    const video = document.getElementById('video');
    const socket = io();
    let pc;

    socket.on('connect', () => {
      socket.emit('watcher');
    });

    socket.on('offer', async (id, desc) => {
      pc = new RTCPeerConnection({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] });

      pc.ontrack = e => {
        video.srcObject = e.streams[0];
      };

      pc.setRemoteDescription(desc).then(() => pc.createAnswer())
        .then(answer => pc.setLocalDescription(answer))
        .then(() => {
          socket.emit('answer', id, pc.localDescription);
        });

      pc.onicecandidate = e => {
        if (e.candidate) {
          socket.emit('candidate', id, e.candidate);
        }
      };
    });

    socket.on('candidate', (id, candidate) => {
      pc.addIceCandidate(new RTCIceCandidate(candidate));
    });

    window.onbeforeunload = () => {
      socket.close();
    };
  </script>
</body>
</html>
